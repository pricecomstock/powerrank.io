version: "3"
services:
  mongo:
    image: 'mongo:3.4.20-xenial'
    container_name: mongo
    restart: always
    ports:
      - '27017:27017'
    volumes:
      - 'mongo:/data/db'
    command: mongod --noauth
    # networks:
    #   - powerranknetwork
    # environment:
    #   MONGO_INITDB_ROOT_USERNAME: root
    #   MONGO_INITDB_ROOT_PASSWORD: example


  powerrank:
    restart: always
    depends_on:
      - 'mongo'
    environment:
      - MONGODB_URI=mongodb://mongo:27017/powerrank
      - __API_BASE_URL__="/api"
      # - NODE_ENV="production"
    build:
      context: .
    ports:
      - "5000:80"
    networks:
      # - reverseproxy
      - default
    labels:
      - "traefik.enable=true"
      - "traefik.backend=powerrank"
      - "traefik.frontend.rule=Host:powerrank.io,powerrank.pc.codes"
      - "traefik.docker.network=traefik_reverseproxy"
    links:
      - mongo
    # networks:
    #   - powerranknetwork

# networks:
#   reverseproxy:
#     external:
#       name: traefik_reverseproxy
# networks:
#   powerranknetwork:
#     driver: bridge

volumes:
  mongo:
